## 音视频的基础知识

> [参卡资料1](https://blog.csdn.net/leixiaohua1020/article/details/18893769)、[参考资料2](https://www.bilibili.com/video/BV1pT4y1R7SN?p=2&spm_id_from=pageDriver)

[音频基础](#音频基础)

[视频基础](#视频基础)

[播放器原理](#播放器原理)

[数据格式](#数据格式)

### 音频基础

* 声音基础原理
  * 声音是纵波(上下波动)，由物体振动产生。
  * 声波的三要素：频率、振幅、波形。
  * 人耳的听力频率范围大约是20Hz~20kHz。
  * 发出声音，在传播过程中遇到障碍物反弹回来，中间时差超过80ms，将产生回声。
* 数字音频原理
  * 采样：根据采样定理，一般采用44.1kHz对原始声音进行采样，可保证人耳听到的声音质量不会降低。
  * 量化：量化是指在幅度轴上对信号进行数字化。
  * 编码：按照一定的格式记录采样和量化后的数字数据。

### 视频基础

* 色彩空间：RGB、YUV。人眼对亮度的敏感度大于对色彩的敏感度，采用YUV存储格式可以减少存储空间并兼容黑白电视。
* 相关概念
  * 视频是由一幅幅图像构成
  * 帧、帧数、帧率、帧率关键值
  * 刷新率
  * 分辨率
  * 码率/比特率

### 播放器原理

* 封装格式：把音频数据和视频数据打包成一个文件的规范。

* 音视频技术点：封装技术、视频压缩编码技术、音频压缩编码技术、流媒体协议技术。

* 视频播放器原理

  ```mermaid
  graph LR
  流媒体数据-->t1((解协议))-->封装格式数据-->s((解封装))
  s-->音频压缩数据-->t2((音频解码))-->音频原始数据-->d((音视频同步))
  s-->视频压缩数据-->t3((视频解码))-->视频原始数据-->d
  d-->音频驱动/设备
  d-->视频驱动/设备
  ```

  * 解协议：将流媒体协议的数据，解析为标准的相应的封装格式数据。播放本地文件不需要解协议。

  * 解封装：将封装格式的数据，分离成音频流压缩编码数据和视频流压缩编码数据。

  * 解码：将音视频压缩编码数据，解码成为非压缩的音视频原始数据。

  * 音视频同步：根据解封装模块处理过程中获得的参数信息，同步解码出音频和视频数据，并将音视频送至系统的声卡和显卡播放。

  * 点播是根据用户需要播放相应的视频节目，主流采用HTTP+H.264+AAC，封装格式的选择区别不大。直播是实时发送内容给用，主流采用RTMP+FLV+H.264+AAC。

  
  ### 数据格式
  
  * 常用格式/协议
  
      | 模块       | 常用                      |
      | ---------- | ------------------------- |
      | 流媒体协议 | RTMP、HTTP-FLV、HLS、RTSP |
      | 封装格式   | MP4、FLV、AVI、TS、MKV    |
      | 视频编码   | H.264、H.265、MPEG4、AVS  |
      | 音频编码   | AAC、MP3、WAV、AC-3、WMA  |
      | 像素数据   | YUV、RGB                  |
      | 音频裸数据 | PCM                       |
      
  * [YUV](https://zhuanlan.zhihu.com/p/75735751)
  
      * 采样格式
        * YUV444：每个像素点的Y、U、V分量采集完整。
        * YUV422：每两个像素点采集所有Y分量、共用一个U、V分量。
        * YUV420：每相邻四个像素点采集所有Y分量，共用一个U分量和一个V分量。
      * 存储格式
        * packet
        * planar
        * semi-planar
      
  * H.264：由视频编码层(VCL)和网络适配层(NAL)组成。
  
      * VCL
          * 压缩：预测(帧内预测和帧间预测) -> DCT变化和量化 -> 比特流编码
          * 切分数据。切片、宏块。
          * 包装成NAL。
      * NALU = NALU header + NALU payload
      * H.264码流结构：starc_code + NALU
      * I帧、P帧、B帧、IDR帧、GOP
      * DTS、PTS
  
  * PCM
  
      * 有6个参数，采样率、量化位数、通道数、符号位、字节序、整型/浮点型
  
  * AAC：分为ADIF和ADTS两种文件格式。
  
      * ADIF：解码必须在明确定义的开始出进行。
      * ADTS：解码可以在流中任何位置开始。
      
  * 流媒体协议：分为推流协议和拉流协议
  
      | 协议     | RTMP              | HTTP-FLV     | HLS            |
      | -------- | ----------------- | ------------ | -------------- |
      | 传输协议 | TCP(默认端口1935) | HTTP(长连接) | HTTP(短连接)   |
      | 封装格式 | flv               | flv          | ts             |
      | 延时     | 1-3秒             | 1-3秒        | 5-20秒         |
      | Web支持  | 需要插件          | 需要插件     | 支持H5         |
      | 数据     | 连续流            | 连续流       | 切片文件(m3u8) |
      | 推拉流   | 都可              | 拉流         | 拉流           |