# 计算机网络

## 概述

* ISP：Internet Service Provider
* 接入网、核心网
* 三种交换方式
  * 电路交换：建立连接、通信、释放连接
  * 分组交换：构造发送、存储转发、接收还原
  * 报文交换
* 性能指标：K、M、G、T等单位进制有时是$2^{10}$有时是$10^3$
  * 速率：bps
  * 带宽：最大能传送数据的速率
  * 吞吐量：单位时间内成功地传送数据量
  * 时延：发送时延、传播时延、处理时延
  * 时延带宽积：传播时延*带宽
  * 往返时间：RTT(Round-Trip Time)
  * 利用率：信道利用率、网络利用率
  * 丢包率：分组丢包率
* 计算机网络体系结构
  * OSI七层：应表会传网数物
  * TCP/IP四层：应用层、传输层、网际层、网络接口层
  * 教学原理五层
    * [应用层](#应用层)：解决通过应用进程的交互来实现特定网络应用的问题，应用层报文。
    * [传输层](#传输层)：解决进程之间基于网络的通信问题，提供端到端的逻辑通信，TCP报文段，UDP数据包。
    * [网络层](#网络层)：解决分组在多个网络上传输(路由)的问题，提供主机之间的逻辑通信，IP数据报/分组。
    * [数据链路层](#数据链路层)：解决分组在一个网络或一段链路上传输的问题，链路层帧。
    * [物理层](#物理层)：解决在各种传输媒体上传输比特0和1的问题，物理层比特流。

## 物理层

* 传输媒体：不属于任何一层
  * 同轴电缆、双绞线、光纤、电力线
  * 无线电波、微波、红外线、可见光
* 传输方式
  * 串行、并行
  * 同步、异步
  * 单工、半双工、全双工

* 通信原理：码元、编码、调制、波特率、比特率、......

## 数据链路层

* 三个重要任务
  
  * 封装成帧：帧头、帧尾、MTU、透明传输
  * 差错检测：CRC
  * 可靠传输：停止-等待协议SW、回退N帧协议GBN、选择重传协议SR
  
* 点对点信道的数据链路层
  
  * 无需MAC地址
  * 点对点协议PPP
    * 链路层协商：链路控制协议LCP
    * 认证协商：默认不认证、PAP、CHAP
    * 网络层协商：网络控制协议NCP(如IPCP、IPV6CP)
  
* 使用广播信道的数据链路层

  * 需要以太网V2 MAC帧

  * 媒体接入控制MAC

    ```mermaid
    graph LR
    mac(媒体接入控制) --- static(静态划分信道)
    mac---dynamic(动态接入控制)
    static --- 频分多址
    static --- 时分多址
    static --- 码分多址
    dynamic --- control(受控接入)
    dynamic --- random(随机接入)
    control --- 集中控制
    control --- 分散控制
    random --- CSMA/CD
    random --- CSMA/CA
    ```

    * 静态划分信道通常在无线网络的物理层中使用，而不是在数据链路层中使用
    * 共享式以太网采用随机接入，但随着技术发展，具有更高性能的使用点对点链路和链路层交换机的交换式局域网在有线领域已完全取代共享式局域网，但由于无线信道的广播天性，无线局域网仍然使用共享媒体技术。
      * 共享式以太网的媒体接入控制协议CSMA/CD
      * 802.11局域网的媒体接入控制协议CSMA/CA

* ARP协议：根据ip地址获取mac地址

  * 每个主机上都有arp缓存表，可以自学习
  * arp请求报文：src：`macA`  dst：`FF-FF-FF-FF-FF-FF`
  * arp响应报文：src：`macB`  dst：`macA`
  * arp协议不能跨网络使用，路由器隔离广播域

* 虚拟局域网VLAN：将局域网内的设备划分成与物理位置无关的逻辑组技术

  * IEEE 802.1Q帧：扩展以太网V2的MAC帧
  * 由交换机支持，而非用户主机处理

## 网络层

* TODO

## 传输层

* TCP
  * 6位选项`URG`、`ACK`、`PSH`、`RST`、`SYN`、`FIN`
    * PSH：表示“推”数据，若设为1，表示希望接收方接收后立即传送给高层，而非缓存。
    * RST：表示请求重置连接。当TCP接收到不能处理的数据段时，向对端发送RST，以清除连接。
  * 重传机制
    * 超时重传：发送丢失、应答丢失
    * 快速重传：3个重复`ack`，可能是选择重传、全部重传
  * 滑动窗口：发送窗口、接收窗口
  * 流量控制：避免发送方数据填满接收方缓存
  * 拥塞控制：避免发送方的数据填满整个网络
    * 慢启动：指数增加
    * 拥塞避免：线性增加
    * 拥塞发生：由重传触发
      * 超时重传：重新慢启动，降低阀值
      * 快速重传：减半加3，拥塞避免(快速恢复)

## 应用层

* DHCP协议使用UDP报文
* HTTP协议演进
  * HTTP 1.1：默认持久化连接、`Chuncked transfer-coding不依赖Content-Length`
  * HTTP 2.0：二进制、多路复用、服务端推送
* [https通信过程](https://blog.csdn.net/weixin_44233929/article/details/105850317)：非对称加密传输对称加密的密钥，对称加密传输数据(不用非对称主要是效率)。[参考](https://zhuanlan.zhihu.com/p/36981565)
  * 客户端向服务端发送TLS版本号、可用加密算法、随机数C
  * 服务端向客户端发送确认的加密算法、证书、公钥、随机数S
  * 客户端验证证书合法性，生成预主密钥、会话密钥
  * 客户端通过公钥加密，发送预主密钥给服务端
  * 服务端接收，私钥解密，得到对称预主密钥
  * 服务端生成会话密钥
  * 客户端和服务端使用会话密钥加密通信

> * 网络拓扑结构
>   * 总线型以太网：早期使用，传输媒体是同轴电缆，使用CSMA/CD
>   * 星型以太网：目前主流，使用双绞线
>     * 使用集线器HUB：逻辑上仍然是总线网，使用CSMA/CD，可以在物理层进行扩展(使用多个集线器)
>     * 使用以太网交换机：为提高网络可靠性可增加冗余链路，使用以太网交换机生成树协议STP生成逻辑上的树状网络
> * 网络互联设备
>   * 中继器
>   * 网桥
>   * 集线器：工作在物理层，每个接口仅简单地复制转发比特，不进行碰撞检测，由各网卡检测
>   * 交换机：工作在数据链路层，收到帧后根据帧交换表查找目的MAC地址对应的接口号，帧交换表是自学习的
>   * 路由器
